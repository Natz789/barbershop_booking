<!-- dashboard/templates/dashboard/admin_appointments.html - VERIFIED FIXED -->
{% extends 'base/base.html' %}
{% load static %}
{% block title %}All Appointments - Admin Dashboard{% endblock %}
{% block extra_css %}
<style>
    .admin-page-header {
        background: linear-gradient(135deg, #c0392b 0%, #8e44ad 100%);
        color: white;
        padding: 2rem;
        border-radius: 8px;
        margin-bottom: 2rem;
    }

    .admin-page-header h1 {
        color: white;
        margin: 0;
    }

    .filter-card {
        background: #f8f9fa;
        border: 2px solid #dee2e6;
    }
</style>
{% endblock %}
{% block content %}
<div class="admin-page-header">
    <h1> All Appointments</h1>
    <p style="margin: 0.5rem 0 0 0; opacity: 0.9;">View and manage all customer appointments</p>
</div>
<div class="card filter-card" style="margin-bottom: 1.5rem;">
    <form method="get" style="display: flex; gap: 1rem; align-items: end; flex-wrap: wrap;">
        <div class="form-group" style="margin-bottom: 0; flex: 1; min-width: 200px;">
            <label>Filter by Status:</label>
            <select name="status" class="form-control">
                <option value="">All Statuses</option>
                <option value="pending" {% if status_filter == 'pending' %}selected{% endif %}>Pending</option>
                <option value="confirmed" {% if status_filter == 'confirmed' %}selected{% endif %}>Confirmed/Scheduled
                </option>
                <option value="completed" {% if status_filter == 'completed' %}selected{% endif %}>Completed</option>
                <option value="cancelled" {% if status_filter == 'cancelled' %}selected{% endif %}>Cancelled</option>
                <option value="declined" {% if status_filter == 'declined' %}selected{% endif %}>Declined</option>
            </select>
        </div>
        <button type="submit" class="btn btn-primary"> Filter</button>
        <a href="{% url 'dashboard:admin_appointments' %}" class="btn btn-secondary">Clear</a>
    </form>
</div>
<div class="card">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
        <h2 style="margin: 0;">
            {% if status_filter %} {{ status_filter|title }} Appointments {% else %} All Appointments {% endif %}
            <span style="color: var(--light-text); font-size: 1rem; font-weight: normal;">({{ appointments.count }}
                total)</span>
        </h2>
        <div style="display: flex; gap: 0.5rem;">
            <a href="{% url 'booking:admin_calendar' %}" class="btn btn-info">🗓️ Calendar View</a>
            <a href="{% url 'dashboard:home' %}" class="btn btn-secondary"> Dashboard</a>
        </div>
    </div>
    {% if appointments %}
    <div class="table-responsive">
        <table class="table">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Customer</th>
                    <th>Barber</th>
                    <th>Service</th>
                    <th>Date</th>
                    <th>Time</th>
                    <th>Status</th>
                    <th>Payment</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for appointment in appointments %}
                <tr>
                    <td><strong>#{{ appointment.id }}</strong></td>
                    <td>{{ appointment.customer.username }}<br><small style="color: var(--light-text);">{{
                            appointment.customer.email }}</small></td>
                    <td>{{ appointment.barber.name }}</td>
                    <td>{{ appointment.service.name }}<br><small style="color: var(--light-text);">{{
                            appointment.service.price }}</small></td>
                    <td>{{ appointment.appointment_date|date:"M d, Y" }}</td>
                    <td>{{ appointment.appointment_time|time:"g:i A" }}</td>
                    <td><span class="badge badge-{{ appointment.status }}">{{ appointment.get_status_display }}</span>
                    </td>
                    <td>{% if appointment.payment %}<span
                            class="badge badge-{{ appointment.payment.payment_status }}">{{
                            appointment.payment.get_payment_status_display }}</span>{% else %}<span
                            class="badge badge-pending">No Payment</span>{% endif %}</td>
                    <td>
                        <a href="{% url 'booking:appointment_detail' appointment.pk %}"
                            class="btn btn-info btn-sm">View</a>

                        {% if appointment.status == 'pending' %}
                        <a href="{% url 'booking:approve_appointment' appointment.pk %}"
                            class="btn btn-success btn-sm">Approve</a>
                        <a href="{% url 'booking:decline_appointment' appointment.pk %}"
                            class="btn btn-danger btn-sm">Decline</a>
                        {% elif appointment.status == 'confirmed' %}
                        {% if appointment.payment and appointment.payment.payment_status == 'paid' %}
                        <a href="{% url 'booking:complete_appointment' appointment.pk %}"
                            class="btn btn-primary btn-sm">Complete</a>
                        {% else %}
                        <a href="{% url 'payments:mark_as_paid' appointment.payment.id %}"
                            class="btn btn-warning btn-sm">Mark Paid</a>
                        {% endif %}
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <div style="text-align: center; padding: 3rem; color: var(--light-text);">
        <div style="font-size: 4rem; margin-bottom: 1rem;"></div>
        <h3>No Appointments Found</h3>
        <p>{% if status_filter %}No {{ status_filter }} appointments found. Try a different filter.{% else %}No
            appointments have been created yet.{% endif %}</p>
    </div>
    {% endif %}
</div>
{% endblock %}